(()=>{"use strict";var e={5413:(e,t,s)=>{var o=s(8649),i=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("Flow")],1)},n=[],r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"flow-container"},[e.lf?t("SelfNodePanel",{attrs:{lf:e.lf}}):e._e(),t("div",{ref:"paper",staticClass:"canvas"}),e.lf?t("SelfControl",{staticClass:"demo-control",attrs:{lf:e.lf}}):e._e()],1)},l=[],a=s(741),d=s(1427),c=function(){var e=this,t=e._self._c;return t("div",{ref:"myNode",staticClass:"node-title"},[e._m(0),e._m(1)])},p=[function(){var e=this,t=e._self._c;return t("span",{staticClass:"node-icon"},[t("i",{staticClass:"el-icon-menu"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"node-name"},[t("span")])}];const u={props:{properties:Object},methods:{},mounted(){let e="#e6f7ff";this?.properties?.frontend_status||(e="#f56c6c"),this.$refs.myNode.style.border=`1px solid ${e}`}},h=u;var f=s(9479),m=(0,f.A)(h,c,p,!1,null,"10141a31",null);const g=m.exports;function y(e){e.register("ordinary",({HtmlNode:e,HtmlNodeModel:t,h:s,createApp:i})=>{class n extends e{setHtml(e){const{properties:t}=this.props.model,s=this.props,i=document.createElement("div");e.innerHTML="",e.appendChild(i);const n=o["default"].extend({render:function(e){return e(g,{props:{name:t.name,Graph:s.graphModel,title:t.title},on:{"select-button":e=>{this.$bus.$emit("select-button",{type:e})},fetchFlow:e=>{s.graphModel.eventCenter.emit("flow:next-step",{type:e,isCurrent:t.isCurrent,isExecuted:t.isExecuted})}}})}});(new n).$mount(i)}}class r extends t{initNodeData(e){super.initNodeData(e);const t=140,s=40;this.width=t,this.height=s,this.anchorsOffset=[[t/2,0],[0,s/2],[-t/2,0],[0,-s/2]],this.isExecuted=e.properties?.isExecuted||!1,this.isCurrent=e.properties?.isCurrent||!1}setAttributes(){let e=this;this.menu=[{text:this.isExecuted?"重新评估":"评估",callback(t){e.graphModel.eventCenter.emit("flow:next-step",{node:t,type:"Drawer",isCurrent:t.properties.isCurrent,isExecuted:t.properties.isExecuted,resetEvaluate:"evaluate"})},className:"custom-setData",icon:!0}]}}return{view:n,model:r}})}var b=function(){var e=this,t=e._self._c;return t("div",{ref:"myNode",staticClass:"node-title"},[e._m(0),e._m(1)])},x=[function(){var e=this,t=e._self._c;return t("span",{staticClass:"node-icon"},[t("i",{staticClass:"el-icon-video-play"})])},function(){var e=this,t=e._self._c;return t("span",{staticClass:"node-name"},[t("span")])}];const v={props:{properties:Object},methods:{},mounted(){let e="#e6f7ff";"0"==this?.properties?.frontend_status&&(e="#f56c6c"),this.$refs.myNode.style.border=`1px solid ${e}`}},w=v;var _=(0,f.A)(w,b,x,!1,null,"540641d0",null);const C=_.exports;function k(e){e.register("start",({HtmlNode:e,HtmlNodeModel:t,h:s})=>{class i extends e{setHtml(e){const{model:t}=this.props,s=document.createElement("div");e.innerHTML="",e.appendChild(s);const i=o["default"].extend({render:function(e){return e(C,{props:{properties:t.properties}})}});(new i).$mount(s)}}class n extends t{constructor(e,t){super(e,t)}getDefaultAnchor(){const{id:e,x:t,y:s,width:o,height:i}=this,n=[];return n.push({x:t,y:s+i/2,id:`${e}_outgoing`,type:"outgoing"}),n}initNodeData(e){super.initNodeData(e);const t=140,s=40;this.width=t,this.height=s,this.radius=50,this.sourceRules=[]}}return{view:i,model:n}})}function $(e){e.register("polyline",e=>{const{BezierEdge:t,BezierEdgeModel:s}=e;class o extends t{}class i extends s{initEdgeData(e){super.initEdgeData(e),this.isExecuted=e.properties.isExecuted||!1,this.isCurrent=e.properties.isCurrent||!1}getEdgeStyle(){const e=super.getEdgeStyle();return e.stroke="#67c23a",e}getEdgeAnimationStyle(){const e=super.getEdgeAnimationStyle();return e.stroke="dodgerBlue",e.animationDuration="60s",e}setAttributes(){this.isAnimation=this.isCurrent}setHovered(e){super.setHovered(e),this.isCurrent||(this.isAnimation=e)}}return{type:"polyline",view:o,model:i}})}class S extends a.nTh{setAttributes(){const{properties:{isExecuted:e}}=this;e&&(this.stroke="green")}}a.Uzs;function D(e){e.register("custom-group",({RectNode:e,RectNodeModel:t,h:s})=>{d.ny.view;const o=e=>class extends e{};o(d.ny.model);class i extends d.Wq.view{getLabelShape(){const{model:e}=this.props;console.log("🚀 ~ CustomGroup ~ getLabelShape ~ model:",e);const{x:t,y:o}=e;return s("text",{fill:"deeppink",fontSize:14,x:10,y:10,width:50,height:25},"Start")}}class n extends d.Wq.model{setAttributes(){}initNodeData(e){super.initNodeData(e),this.foldable=!0,this.resizable=!0,this.properties={children:[],collapsible:!1,isCollapsed:!1,width:200,height:400,collapsedWidth:80,collapsedHeight:60,radius:5,isRestrict:!0,autoResize:!0,transformWithContainer:!0,zIndex:-1e3,autoToFront:!0},this.width=230,this.height=300,this.isRestrict=!0,this.autoResize=!0,this.radius=10}getNodeStyle(){const e=super.getNodeStyle();return e.strokeWidth=1,e.strokeDasharray="3 3",e.stroke="#fec171",e.radius=5,e}getAddableOutlineStyle(){const e=super.getAddableOutlineStyle();return e.stroke="#52c41a",e.strokeDasharray="4 4",e.strokeWidth=2,e}foldGroup(e){super.foldGroup(e),e?(this.foldedText&&(this.text={...this.foldedText}),this.text||(this.text="已折叠分组已折叠分组已折叠分组"),this.text.x=this.x+10,this.text.y=this.y):(this.foldedText={...this.text},this.text="")}getAnchorStyle(){const e=super.getAnchorStyle();return e.stroke="#1890ff",e.fill="#ffffff",e}}return{view:i,model:n}})}var N=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"panelLayout",staticStyle:{background:"#fff"}},[t("el-tooltip",{attrs:{content:"放大",title:"放大",placement:"left"}},[t("i",{staticClass:"el-icon-zoom-in",on:{click:e.$_zoomIn}})]),t("el-tooltip",{attrs:{content:"缩小",title:"缩小",placement:"left"}},[t("i",{staticClass:"el-icon-zoom-out",on:{click:e.$_zoomOut}})]),t("el-tooltip",{attrs:{content:"大小适应",title:"大小适应",placement:"left"}},[t("i",{staticClass:"el-icon-aim",on:{click:e.$_zoomReset}})]),t("el-tooltip",{attrs:{content:"定位还原(大小&定位)",title:"定位还原(大小&定位)",placement:"left"}},[t("i",{staticClass:"el-icon-position",on:{click:e.$_reset}})]),t("el-tooltip",{attrs:{content:"上一步",title:"上一步",placement:"left"}},[t("i",{staticClass:"el-icon-d-arrow-left",attrs:{disabled:e.undoDisable},on:{click:e.$_undo}})]),t("el-tooltip",{attrs:{content:"下一步",title:"下一步",placement:"left"}},[t("i",{staticClass:"el-icon-d-arrow-right",attrs:{disabled:e.redoDisable},on:{click:e.$_redo}})])],1)])},E=[];const M={name:"Control",props:{lf:"",catTurboData:Boolean},data(){return{undoDisable:!0,redoDisable:!0,graphData:null,dataVisible:!1}},mounted(){this.$props.lf.on("history:change",({data:{undoAble:e,redoAble:t}})=>{this.$data.undoDisable=!e,this.$data.redoDisable=!t})},methods:{$_zoomIn(){this.$props.lf.zoom(!0)},$_zoomOut(){this.$props.lf.zoom(!1)},$_zoomReset(){this.$props.lf.resetZoom()},$_translateRest(){this.$props.lf.resetTranslate()},$_reset(){this.$props.lf.resetZoom(),this.$props.lf.resetTranslate()},$_undo(){this.$props.lf.undo()},$_redo(){this.$props.lf.redo()},$_download(){this.$props.lf.extension.snapshot.customCssRules="\n    .lf-canvas-overlay {\n      background: #f0f4fb;\n    }\n  ",this.$props.lf.getSnapshot()},$_catTurboData(){this.$emit("catTurboData")},$_showMiniMap(){const{lf:e}=this.$props;e.extension.miniMap.show(e.graphModel.width-175,220)}}},T=M;var A=(0,f.A)(T,N,E,!1,null,"6a62bbb1",null);const z=A.exports;var O=function(){var e=this,t=e._self._c;return t("div",{staticClass:"node-panel"},[t("el-input",{staticClass:"mt15",staticStyle:{"margin-bottom":"8px"},attrs:{"prefix-icon":"el-icon-search",placeholder:"输入关键字"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),t("div",{staticClass:"group-tree",staticStyle:{cursor:"pointer"},attrs:{draggable:""}},[t("i",{staticClass:"el-icon-menu",staticStyle:{color:"#47c769",margin:"0 10px"}}),t("span",{staticClass:"drag-label",on:{mousedown:function(t){return e.mousedownFunc(e.groupNode)}}},[e._v("流程分组")])]),t("div",[t("el-tree",{ref:"treeRef",attrs:{data:e.treeList,"default-expand-all":"","node-key":"id",props:e.treeProps,draggable:!1,"allow-drop":e.allowDrop,"filter-node-method":e.filterNodeMethod},scopedSlots:e._u([{key:"default",fn:function({node:s,data:o}){return[t("span",{staticClass:"custom-tree-node"},[o.children?e._e():t("i",{staticClass:"el-icon-menu"}),t("span",{staticClass:"drag-label",attrs:{title:s.label},on:{mousedown:function(t){return e.mousedownFunc(o)}}},[e._v(e._s(s.label))])])]}}])})],1),t("el-button",{on:{click:e.showModel}},[e._v("show model")])],1)},F=[];const R=()=>{var e=Date.now().toString(),t=Math.floor(9e15*Math.random())+1e15,s=e+t.toString();return s.length>19&&(s=s.substr(0,19)),"0"===s.charAt(0)&&(s="1"+s.substr(1)),s},P={name:"NodePanel",props:{lf:null},data(){return{treeList:[{id:"2",name:"通用节点",children:[{id:"21",type:"ordinary",name:"数据管理"},{id:"22",type:"ordinary",name:"指标体系"},{id:"23",type:"ordinary",name:"灵敏度"}]},{id:"3",name:"效能节点",children:[{id:"31",type:"ordinary",name:"效能评估结果"}]},{id:"4",name:"关联度节点",children:[{id:"41",type:"ordinary",name:"效能评估结果"}]},{id:"5",name:"贡献率节点",children:[{id:"51",type:"ordinary",name:"使命任务分析"},{id:"52",type:"ordinary",name:"场景设置"},{id:"53",type:"ordinary",name:"评估矩阵"},{id:"54",type:"ordinary",name:"贡献率计算"}]}],filterText:"",treeProps:{children:"children",label:"name"},dragRow:{type:"ordinary"},randomNumber:null,radio:1,groupNode:{id:"51",type:"custom-group",name:"使命任务分析"}}},watch:{filterText(e){this.$refs.treeRef.filter(e)}},mounted(){this.lf.on("node:dnd-add",()=>{"start"==this.dragRow.type&&this.lf.setProperties(this.randomNumber,{frontend_status:"0"})}),this.changeRadio(this.radio)},methods:{async mousedownFunc(e){let t=["push","start","user","end","rect","task","download","circle","polygon","diamond","baseNode","ordinary","group","custom-group"];t.includes(e.type)&&(this.dragRow=e,this.randomNumber=R(),this.lf.dnd.startDrag({type:e.type,text:e.name}))},allowDrop(){return!1},filterNodeMethod(e,t){return!e||-1!==t.name.toLowerCase().indexOf(e.toLowerCase())},changeRadio(e){if(e)return this.lf.openSelectionSelect();this.lf.closeSelectionSelect()},showModel(){console.log("this.lf.graphModel :>> ",this.lf.graphModel),console.log("this.lf.graphModel.nodes :>> ",this.lf.graphModel.nodes),console.log("this.lf.graphModel.edges :>> ",this.lf.graphModel.edges),console.log("this.lf.getGraphData() :>> ",this.lf.getGraphData())}}},H=P;var j=(0,f.A)(H,O,F,!1,null,"6d0245c1",null);const W=j.exports,L={components:{SelfControl:z,SelfNodePanel:W},data(){return{lf:null,selected:null,lastPoint:{x:100,y:100}}},async mounted(){await this.init(),await this.render()},methods:{init(){const e=this.$refs.paper,t=e.clientWidth-5,s=e.clientHeight-5;this.lf=new a.Ay$({container:e,background:{backgroundColor:"#f0f4fb"},width:t,height:s,grid:{type:"dot",size:20},keyboard:{enabled:!0},plugins:[d.LR,d.kj,d.W1,d.tu,d.r7],adjustEdge:!1,adjustEdgeStartAndEnd:!1,edgeSelectedOutline:!0,edgeTextDraggable:!1,nodeTextDraggable:!1,nodeTextEdit:!0,edgeTextEdit:!1,autoExpand:!1,textEdit:!1,snapline:!1,pluginsOptions:{proximityConnect:{enable:!1}}}),this.lf.setTheme({baseNode:{fill:"#FFFFFF",stroke:"#000000",strokeWidth:1},circle:{stroke:"#000000",strokeWidth:1},rect:{fill:"#FFFFFF",stroke:"#000000",outlineColor:"#88f",strokeWidth:1},nodeText:{color:"#000000",overflowMode:"ellipsis",padding:"0 15px",fontSize:14},edgeText:{color:"#000000",background:{fill:"#f0f4fb"}}}),window.addEventListener("resize",this.updateSize),k(this.lf),y(this.lf),$(this.lf),D(this.lf)},updateSize(){const e=this.$refs.paper,{clientWidth:t,clientHeight:s}=e;this.lf.resize(t-5,s-5)},render(){let e={nodes:[{id:"1706150553091901403",type:"start",x:660,y:70,properties:{variables:[],structs:[],frontend_status:"0",name:"方案概述"},text:{x:660,y:70,value:"方案概述"}}]};this.lf.render(e),this.lfEvent(),this.$nextTick(()=>{})},lfEvent(){this.lf.on("node:dbclick",({data:e})=>{}),this.lf.on("edge:dbclick",({data:e})=>{}),this.lf.on("edge:app-config",e=>{}),this.lf.on("element:click",()=>{}),this.lf.on("blank:click",()=>{}),this.lf.on("connection:not-allowed",e=>{}),this.lf.on("edge:add",({data:e})=>{}),this.lf.on("node:dnd-add",({data:e})=>{const{id:t,type:s}=e;if("custom-group"===s)return;const o=this.lf.graphModel.dynamicGroup?.getGroupByNodeId(t);o?console.log("🚀 ~ lfEvent ~ nodeGroup:",o):(this.lf.graphModel.deleteNode(e.id),this.$message.warning("节点只能放入分组节点中"))}),this.lf.on("node:delete",({data:e})=>{"start"===e.type&&(this.$nextTick(()=>{this.lf.graphModel.addNode(e)}),this.$message.warning("起始节点不可删除"))}),this.lf.on("edge:delete",({data:e})=>{}),this.lf.on("node:contextmenu",e=>{const{data:t,e:s}=e;s.preventDefault(),"start"!==t.type&&this.$contextmenu({items:[{label:"编辑节点",icon:"el-icon-edit",onClick:()=>{},divided:!0},{label:"删除节点",icon:"el-icon-delete",onClick:()=>{this.lf.deleteNode(t.id)}}],event:s,zIndex:3,minWidth:150})}),this.lf.on("node:dragstart",({data:e})=>{const{id:t,type:s,x:o,y:i}=e}),this.lf.on("node:properties-change",({id:e,properties:t,preProperties:s})=>{const o=this.lf.getNodeModelById(e);if(o?.isGroup){const o=s.isCollapsed,i=t.isCollapsed;o!==i&&console.log(`分组 ${e} 状态变化: ${i?"折叠":"展开"}`)}})},clickPlus(e,t){e.stopPropagation(),console.log("clickPlus",e,t);const{clientX:s,clientY:o}=e;console.log(s,o)},mouseDownPlus(e,t){console.log("mouseDownPlus",e,t)},keyboardCopyHandler(){this.lf.getSelectElements(!0)},keyboardDelHandler(){this.lf.getSelectElements(!0)}}},G=L;var B=(0,f.A)(G,r,l,!1,null,null,null);const I=B.exports,q={name:"App",components:{Flow:I}},Z=q;var U=(0,f.A)(Z,i,n,!1,null,null,null);const V=U.exports;var X=s(1093),Y=s.n(X),J=s(8803);o["default"].config.productionTip=!1,o["default"].use(J.A),o["default"].use(Y(),{size:"medium"}),new o["default"]({render:e=>e(V)}).$mount("#app")}},t={};function s(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(n.exports,n,n.exports,s),n.loaded=!0,n.exports}s.m=e,(()=>{s.amdO={}})(),(()=>{var e=[];s.O=(t,o,i,n)=>{if(!o){var r=1/0;for(c=0;c<e.length;c++){for(var[o,i,n]=e[c],l=!0,a=0;a<o.length;a++)(!1&n||r>=n)&&Object.keys(s.O).every(e=>s.O[e](o[a]))?o.splice(a--,1):(l=!1,n<r&&(r=n));if(l){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[o,i,n]}})(),(()=>{s.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return s.d(t,{a:t}),t}})(),(()=>{s.d=(e,t)=>{for(var o in t)s.o(t,o)&&!s.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{s.nmd=e=>(e.paths=[],e.children||(e.children=[]),e)})(),(()=>{var e={524:0};s.O.j=t=>0===e[t];var t=(t,o)=>{var i,n,[r,l,a]=o,d=0;if(r.some(t=>0!==e[t])){for(i in l)s.o(l,i)&&(s.m[i]=l[i]);if(a)var c=a(s)}for(t&&t(o);d<r.length;d++)n=r[d],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},o=self["webpackChunkvue2_logicflow_demo"]=self["webpackChunkvue2_logicflow_demo"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var o=s.O(void 0,[96],()=>s(5413));o=s.O(o)})();
//# sourceMappingURL=app.6e052efe.js.map